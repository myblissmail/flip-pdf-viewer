<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>線上翻頁 PDF 閱覽器</title>
  <style>
    body {
      margin: 0;
      font-family: "Segoe UI", sans-serif;
      display: flex;
      flex-direction: column;
      height: 100vh;
      overflow: hidden;
      background-color: #f5f5f5;
    }
    #viewer {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
      gap: 10px;
      padding: 10px;
    }
    canvas {
      width: 48%;
      height: auto;
      transition: transform 0.3s ease;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      border-radius: 8px;
      background: #fff;
    }
    #controls {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 8px;
      padding: 10px;
      background: #ffffff;
      border-top: 1px solid #ccc;
      position: sticky;
      bottom: 0;
      z-index: 100;
    }
    button, select, input[type="number"] {
      padding: 8px 12px;
      font-size: 14px;
      border-radius: 8px;
      border: 1px solid #ccc;
      background-color: #ffffff;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      transition: background-color 0.2s;
    }
    input[type="number"]#autoFlipSec {
      width: 50px;
      padding: 6px 8px;
    }
    button:hover {
      background-color: #f0f0f0;
    }
    #bookmark-list {
      max-height: 100px;
      overflow-y: auto;
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
    }
    #bookmark-list button {
      white-space: nowrap;
    }
    #pageIndicator {
      font-size: 14px;
      margin-top: 5px;
      text-align: center;
      width: 100%;
    }
    @media (max-width: 768px) {
      #controls {
        flex-direction: column;
        align-items: center;
      }
      button, select, input[type="number"] {
        width: 90%;
        max-width: 300px;
      }
      canvas {
        width: 95% !important;
      }
    }
  </style>
</head>
<body>
  <div id="viewer">
    <canvas id="left-page"></canvas>
    <canvas id="right-page"></canvas>
  </div>
  <div id="controls">
    <input type="file" id="fileInput" accept="application/pdf" />
    <button onclick="goToPage(1)" id="btn-first">首頁</button>
    <button onclick="changePage(-2)" id="btn-prev">上一頁</button>
    <button onclick="changePage(2)" id="btn-next">下一頁</button>
    <button onclick="goToEnd()" id="btn-last">末頁</button>
    <button onclick="toggleFullscreen()" id="btn-full">全螢幕</button>
    <button onclick="toggleAutoFlip()" id="btn-auto">自動翻頁</button>
    <input type="number" id="autoFlipSec" min="1" value="5" title="翻頁秒數" />
    <button onclick="toggleSound()" id="btn-sound">音效開</button>
    <button onclick="toggleEffect()" id="btn-effect">特效開</button>
    <select onchange="switchLang(this.value)">
      <option value="zh">繁體中文</option>
      <option value="en">English</option>
    </select>
    <button onclick="addBookmark()" id="btn-bookmark">加入書籤</button>
    <div id="bookmark-list"></div>
    <span id="pageIndicator"></span>
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
  <script>
    let pdfDoc = null, currentPage = 1, totalPages = 0;
    let lang = 'zh';
    let autoFlip = false, autoFlipInterval = null;
    let soundEnabled = true, effectEnabled = true;

    const fileInput = document.getElementById("fileInput");
    const leftCanvas = document.getElementById("left-page");
    const rightCanvas = document.getElementById("right-page");
    const controls = document.getElementById("controls");

    fileInput.addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (!file || file.type !== "application/pdf" || !file.name.endsWith(".pdf")) {
        alert(lang === 'zh' ? "請選擇正確的 PDF 檔案。" : "Please select a valid PDF file.");
        return;
      }
      const reader = new FileReader();
      reader.onload = () => {
        try {
          const typedArray = new Uint8Array(reader.result);
          pdfjsLib.getDocument(typedArray).promise.then(pdf => {
            pdfDoc = pdf;
            totalPages = pdf.numPages;
            const savedPage = parseInt(localStorage.getItem("pdfCurrentPage"));
            currentPage = (!isNaN(savedPage) && savedPage >= 1 && savedPage <= totalPages) ? savedPage : 1;
            controls.style.display = "flex";
            renderPages();
          }).catch(error => {
            console.error("PDF 加載失敗：", error);
            alert(lang === 'zh' ? "PDF 無法正確載入。" : "Failed to load the PDF.");
          });
        } catch (err) {
          console.error("檔案轉換錯誤：", err);
          alert(lang === 'zh' ? "無效的檔案內容。" : "Invalid file content.");
        }
      };
      reader.readAsArrayBuffer(file);
    });

    function switchLang(language) {
      lang = language;
      document.getElementById("btn-first").innerText = lang === 'zh' ? "首頁" : "First";
      document.getElementById("btn-prev").innerText = lang === 'zh' ? "上一頁" : "Prev";
      document.getElementById("btn-next").innerText = lang === 'zh' ? "下一頁" : "Next";
      document.getElementById("btn-last").innerText = lang === 'zh' ? "末頁" : "Last";
      document.getElementById("btn-full").innerText = lang === 'zh' ? "全螢幕" : "Fullscreen";
      document.getElementById("btn-auto").innerText = autoFlip ? (lang === 'zh' ? "停止翻頁" : "Stop Auto Flip") : (lang === 'zh' ? "自動翻頁" : "Auto Flip");
      document.getElementById("btn-sound").innerText = soundEnabled ? (lang === 'zh' ? "音效開" : "Sound On") : (lang === 'zh' ? "音效關" : "Sound Off");
      document.getElementById("btn-effect").innerText = effectEnabled ? (lang === 'zh' ? "特效開" : "Effect On") : (lang === 'zh' ? "特效關" : "Effect Off");
      document.getElementById("btn-bookmark").innerText = lang === 'zh' ? "加入書籤" : "Add Bookmark";
      document.querySelectorAll("#bookmark-list button").forEach(btn => {
        const match = btn.innerText.match(/\d+/);
        if (match) {
          const page = match[0];
          btn.innerText = lang === 'zh' ? `第 ${page} 頁` : `Page ${page}`;
        }
      });
    }
  </script>
</body>
</html>
